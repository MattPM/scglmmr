<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scglmmr">
<title>Pseudobulk differential expression with nested group repeated measures single cell experiment designs • scglmmr</title>
<script src="../deps/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pseudobulk differential expression with nested group repeated measures single cell experiment designs">
<meta property="og:description" content="scglmmr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scglmmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pseudobulk_mixed_effects.html">Pseudobulk differential expression with nested group repeated measures single cell experiment designs</a>
    <a class="dropdown-item" href="../articles/scglmmr_singlecell.html">Single cell gene and module differential expression with nested group repeated measures experiment designs</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MattPM/scglmmr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Pseudobulk differential expression with nested group repeated measures single cell experiment designs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MattPM/scglmmr/blob/HEAD/vignettes/pseudobulk_mixed_effects.rmd" class="external-link"><code>vignettes/pseudobulk_mixed_effects.rmd</code></a></small>
      <div class="d-none name"><code>pseudobulk_mixed_effects.rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="pseudobulk-mixed-effects-models">1. pseudobulk mixed effects models<a class="anchor" aria-label="anchor" href="#pseudobulk-mixed-effects-models"></a>
</h3>
<p>These functions implement wrappers around limma for fitting fixed
effect linear models, and the <code>dream</code> method from the
<code>variancePartition</code> package forfitting mixed (i.e. varying)
effects models. Mixed models are necessary for experiments that have the
design of repeated measurements from the same donors in perturbation
studies in multi sample ‘random’ (varying) effects. This is necessary to
account for non-independence when we have perturbation experiments with
repeated measurements from the same donors. To enable linear models
(e.g. modeling the mean with a normal distribution) to be fit to gene
counts, <code><a href="https://rdrr.io/pkg/variancePartition/man/dream-method.html" class="external-link">variancePartition::dream</a></code> accounts for the mean
variance trend via incorporating voom observational weights. The
approach is described in <a href="doi.org/10.1093/bioinformatics/btaa687">Hoffman et al
Bininformatics 2020</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#devtools::install_github(repo = "https://github.com/MattPM/scglmmr")</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MattPM/scglmmr" class="external-link">scglmmr</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span><span class="op">)</span>
<span class="co">#the mixed model fits and gsea are parallelized </span>
<span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html" class="external-link">SnowParam</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">pparam</span> <span class="op">=</span> <span class="fu">BiocParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SnowParam-class.html" class="external-link">SnowParam</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fl">4</span>, type <span class="op">=</span> <span class="st">"SOCK"</span>, progressbar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Below analysis of a 2 group repeated measures experiment design is
shown. Pre-treatment baseline effect differences, treatment effets
across all donors and the difference in treatment effects are all
compared while modeling variation in baseline expression using a random
intercept term.</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="18%">
<col width="18%">
<col width="21%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">sample</th>
<th align="center">sampleid</th>
<th align="right">time</th>
<th align="left">group</th>
<th align="center">sex</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">101_t0</td>
<td align="center">101</td>
<td align="right">d0</td>
<td align="left">low</td>
<td align="center">F</td>
</tr>
<tr class="even">
<td align="left">101_t1</td>
<td align="center">101</td>
<td align="right">d1</td>
<td align="left">high</td>
<td align="center">F</td>
</tr>
<tr class="odd">
<td align="left">102_t0</td>
<td align="center">102</td>
<td align="right">d0</td>
<td align="left">low</td>
<td align="center">M</td>
</tr>
<tr class="even">
<td align="left">102_t1</td>
<td align="center">102</td>
<td align="right">d1</td>
<td align="left">high</td>
<td align="center">M</td>
</tr>
<tr class="odd">
<td align="left">… (x n donors)</td>
<td align="center">… (x n donors)</td>
<td align="right">… (x n donors)</td>
<td align="left">… (x n donors)</td>
<td align="center">… (x n donors)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="load-single-cell-data-aggregate-and-quaity-control">Load single cell data, aggregate and quaity control<a class="anchor" aria-label="anchor" href="#load-single-cell-data-aggregate-and-quaity-control"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">datapath</span> <span class="op">=</span> <span class="st">"mypath/"</span>

<span class="co"># load seurat or sce object etc. </span>
<span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"path/seuratobject.rds"</span><span class="op">)</span>

<span class="co"># define counts and metadata and subset to cells above rm seurat object from workspace </span>
<span class="va">meta</span> <span class="op">=</span> <span class="va">s</span><span class="op">@</span><span class="va">meta.data</span>
<span class="va">umi</span> <span class="op">=</span> <span class="va">s</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">counts</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># QC contingency of cells by subject for each celltype </span>
<span class="va">tab</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/SubjectCelltypeTable.html">SubjectCelltypeTable</a></span><span class="op">(</span>metadata <span class="op">=</span> <span class="va">meta</span>, celltype_column <span class="op">=</span> <span class="st">"celltype"</span>, sample_column <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span>
<span class="va">tab</span><span class="op">$</span><span class="va">celltypes_remove</span>; <span class="va">tab</span><span class="op">$</span><span class="va">`low representation celltypes`</span>; <span class="va">tab</span><span class="op">$</span><span class="va">table</span>

<span class="co"># remove cells prior to pseudobulk analysis </span>
<span class="va">meta</span> <span class="op">=</span> <span class="va">meta</span><span class="op">[</span><span class="op">!</span><span class="va">meta</span><span class="op">$</span><span class="va">celltype</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">tab</span><span class="op">$</span><span class="va">celltypes_remove</span>, <span class="op">]</span>

<span class="co"># subset data </span>
<span class="va">umi</span> <span class="op">=</span> <span class="va">umi</span><span class="op">[</span> ,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Create aggregated pseudobulk data</span>
<span class="va">pb</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/PseudobulkList.html">PseudobulkList</a></span><span class="op">(</span>
  rawcounts <span class="op">=</span> <span class="va">umi</span>,
  metadata <span class="op">=</span> <span class="va">meta</span>, 
  sample_col <span class="op">=</span> <span class="st">"sample"</span>,
  celltype_col <span class="op">=</span> <span class="st">"celltype"</span>,
  avg_or_sum <span class="op">=</span> <span class="st">"sum"</span>
  <span class="op">)</span>


<span class="co"># Create aggretated sample level metadata</span>
<span class="va">met</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/AggregateCellMetadata.html">AggregateCellMetadata</a></span><span class="op">(</span>
  cell.metadata <span class="op">=</span> <span class="va">meta</span>, 
  sample_column <span class="op">=</span> <span class="st">'sample'</span>, 
  variable_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'subjectid'</span>, <span class="st">'timepoint'</span>, <span class="st">'response'</span>, <span class="st">'age'</span>, <span class="st">'sex'</span><span class="op">)</span>,
  pseudobulk.List <span class="op">=</span> <span class="va">pb</span>
  <span class="op">)</span>

<span class="co"># creation of a combined grouping factor indicating both timepoint and group</span>
<span class="co"># (e.g. t0_Group1, t0_group2) will make it simple to set up contrasts.</span>
<span class="co"># here group means 'response group' i.e. high vs low responder. </span>
<span class="co"># also convert other variables to factors and do some standard transformation</span>
<span class="co"># of metadata.</span>
<span class="va">met</span><span class="op">$</span><span class="va">group.time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">met</span><span class="op">$</span><span class="va">group</span>, <span class="va">met</span><span class="op">$</span><span class="va">timepoint</span>, sep <span class="op">=</span> <span class="st">'_'</span><span class="op">)</span>

<span class="co"># make sure this is a factor and the levels are in a coherent order for the </span>
<span class="co"># contrast matrix -- see below. here: </span>
<span class="co"># time 0 = 0, time 1 = 1. </span>
<span class="co"># low response = 0 high response = 1. </span>
<span class="va">met</span><span class="op">$</span><span class="va">group.time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>
  <span class="va">met</span><span class="op">$</span><span class="va">group.time</span>,
  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1_0"</span>, <span class="st">"1_1"</span>, <span class="st">"0_0"</span>, <span class="st">"0_1"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># now filter genes within each cell type that are reasonably expressed. </span>
<span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">met</span><span class="op">$</span><span class="va">group.time</span><span class="op">)</span>
<span class="va">dge</span> <span class="op">=</span> <span class="fu"><a href="../reference/Normalize.html">Normalize</a></span><span class="op">(</span>pseudobulk.list <span class="op">=</span> <span class="va">pb</span>, design <span class="op">=</span> <span class="va">design</span>, minimum.gene.count <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-models-and-specify-a-priori-contrasts-corresponding-to-the-desired-effect-comparisons">Fit models and specify a priori contrasts corresponding to the
desired effect comparisons<a class="anchor" aria-label="anchor" href="#fit-models-and-specify-a-priori-contrasts-corresponding-to-the-desired-effect-comparisons"></a>
</h3>
<p>Below we use a function from the variancePartition package
makeContrastsDream which is similar to the function makeContrasts from
limma and works the same way.</p>
<p>We also specify a varying intercept model using lme4 symbolic
formula. <a href="https://arxiv.org/pdf/1911.08628.pdfs" class="external-link">More
information on symbolic model formulas</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Now we  specify model </span>
<span class="va">f1</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">group.time</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">subjectid</span><span class="op">)</span> 

<span class="co"># make contrast matrix </span>
<span class="va">L2</span> <span class="op">=</span> <span class="fu">makeContrastsDream</span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">f1</span>, 
  data <span class="op">=</span> <span class="va">samplemd</span>,
  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    baseline <span class="op">=</span> <span class="st">"group.time1_0 - group.time0_0"</span>, <span class="co"># note fixef model also fit for this single time point contrast </span>
    treatment_delta <span class="op">=</span> <span class="st">"( group.time1_1 - group.time1_0 ) - ( group.time0_1 - group.time0_0 )"</span>,
    treatment <span class="op">=</span> <span class="st">"( group.time1_1 + group.time0_1 ) / 2 - ( group.time1_0 + group.time0_0 ) / 2 "</span>
    <span class="op">)</span>
  <span class="op">)</span>

<span class="co"># visualize the contrast matrix, compare to levels of group.time variable</span>
<span class="co"># to check for correctly specified effects. </span>
<span class="fu">plotContrasts</span><span class="op">(</span><span class="va">L2</span><span class="op">)</span> </code></pre></div>
<p>Fit the models with <code><a href="https://rdrr.io/pkg/variancePartition/man/dream-method.html" class="external-link">variancePartition::dream</a></code> which uses
voom weights in lme4 mixed effects models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">fit1</span> <span class="op">=</span> <span class="fu"><a href="../reference/FitDream.html">FitDream</a></span><span class="op">(</span>pb.list <span class="op">=</span> <span class="va">dge</span>, 
                sample.metadata <span class="op">=</span> <span class="va">met</span>, 
                lme4.formula <span class="op">=</span> <span class="va">f1</span>,
                dream.contrast.matrix <span class="op">=</span> <span class="va">L2</span>,
                ncores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">fit1</span> <span class="op">=</span> <span class="fu">variancePartition</span><span class="fu">::</span><span class="fu">eBayes</span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></code></pre></div>
<p>Note, <code><a href="https://rdrr.io/pkg/variancePartition/man/dream-method.html" class="external-link">variancePartition::dream</a></code> now incorporates an
emperical Bayes step derived for mixed effects models accounting for per
gene degrees of freedom, please see: <a href="https://github.com/GabrielHoffman/variancePartition/issues/54" class="external-link uri">https://github.com/GabrielHoffman/variancePartition/issues/54</a>.</p>
</div>
<div class="section level3">
<h3 id="downstream-gene-set-enrichment-analysis-within-celltypes-for-different-effects">Downstream gene set enrichment analysis within celltypes for
different effects<a class="anchor" aria-label="anchor" href="#downstream-gene-set-enrichment-analysis-within-celltypes-for-different-effects"></a>
</h3>
<p>Run gene set enrichment analysis within each cell type fbased on
genes ranked by effect size for each of the effects defined above.</p>
<p>Here within each cell type and for each contrast we run gene set
enrichment analysis using 2 functions <code>ExtractResult</code> and
<code>FgseaList</code>. <code>ExtractResult</code> is used to extract a
list of gene ranks (it can be used as a wrapper around dream::topTable
and limma::topTable to return a full list of results). Since we had
multiple covariates in a mixed model and we used a custom contrast
matrix, we specify the covariate of interest from the contrast using
arguments <code>coefficient.number</code> and <code>coef.name</code>
which are output in results based on the names of the contrasts.</p>
<p>With the list of ranks we then run gene set enrichment with the <a href="https://www.biorxiv.org/content/10.1101/060012v3" class="external-link">fgsea method by
Korotkevich et al</a> using the function <code>FseaList</code>.</p>
<p>Based on our contrast matrix (the object <code>L2</code> we created
above with <code>makeContrastsDream</code>),
<code>coefficient.number = 1</code> corresponds to the baseline
difference between groups, <code>coefficient.number = 2</code> is the
difference in fold changes between the groups and
<code>coefficient.number = 3</code> is the pre vs post perturbation
difference across subjects in both groups.</p>
<div class="section level4">
<h4 id="examples-of-extracting-gene-ranks-based-on-contrasts-and-running-gene-set-enrichment">Examples of extracting gene ranks based on contrasts and running
gene set enrichment<a class="anchor" aria-label="anchor" href="#examples-of-extracting-gene-ranks-based-on-contrasts-and-running-gene-set-enrichment"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># msigDB hallmark pathways are included in the scglmmr package</span>
<span class="va">hlmk</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="va">hallmark</span>
<span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/ExtractResult.html">ExtractResult</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># extract genes ranked by treatment effect (across all donors) </span>
<span class="va">rtreat</span> <span class="op">=</span> <span class="fu"><a href="../reference/ExtractResult.html">ExtractResult</a></span><span class="op">(</span>model.fit.list <span class="op">=</span> <span class="va">fit1</span>,
                       what <span class="op">=</span> <span class="st">'lmer.z.ranks'</span>,
                       coefficient.number <span class="op">=</span> <span class="fl">3</span>,
                       coef.name <span class="op">=</span> <span class="st">'treatment'</span><span class="op">)</span>
<span class="co"># run fgsea </span>
<span class="va">hlmk.treat</span> <span class="op">=</span> <span class="fu"><a href="../reference/FgseaList.html">FgseaList</a></span><span class="op">(</span>rank.list.celltype <span class="op">=</span> <span class="va">rtreat</span>,
                       pathways <span class="op">=</span> <span class="va">hlmk</span>,
                       BPPARAM <span class="op">=</span> <span class="va">pparam</span><span class="op">)</span>



<span class="co"># extract gene ranks of treatment effect (across all donors) </span>
<span class="va">rdelta</span> <span class="op">=</span> <span class="fu"><a href="../reference/ExtractResult.html">ExtractResult</a></span><span class="op">(</span>model.fit.list <span class="op">=</span> <span class="va">fit1</span>,
                       what <span class="op">=</span> <span class="st">'lmer.z.ranks'</span>,
                       coefficient.number <span class="op">=</span> <span class="fl">2</span>,
                       coef.name <span class="op">=</span> <span class="st">'treatment_delta'</span><span class="op">)</span>
<span class="va">hlmk.delta</span> <span class="op">=</span> <span class="fu"><a href="../reference/RunFgseaOnRankList.html">RunFgseaOnRankList</a></span><span class="op">(</span>rank.list.celltype <span class="op">=</span> <span class="va">rdelta</span>,
                                pathways <span class="op">=</span> <span class="va">hlmk</span>,
                                BPPARAM <span class="op">=</span> <span class="va">pparam</span><span class="op">)</span></code></pre></div>
<p>On a technical note, it’s also possible to fit a simple model for the
baseline contrast not estimating the variation across subjects with a
random effect as this contrast is more typically estimated with a
standard group 1 vs 2 least squares approach. The function
<code>RunVoomLimma</code> is provided to fit these models. If you
compare the effect size estimates for an individual cell type for the
<code>coefficient.number = 1</code> from the mixed model fits (object
<code>fit1</code> above) to the models below they will be very highly
corrleated along the diagonal with some differences arising to the
different degrees of freedom, sample size and variance coming from the
additional layer of variation estimated by the mixed model. The choice
of model to use is up to the user.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit simple linear model for the baseline group level contrast </span>
<span class="va">design.2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="fl">0</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">group.time</span>, data <span class="op">=</span> <span class="va">met</span><span class="op">)</span>
<span class="va">fit0</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/RunVoomLimma.html">RunVoomLimma</a></span><span class="op">(</span>dgelists <span class="op">=</span> <span class="va">dge</span>, 
                           design_matrix <span class="op">=</span> <span class="va">design.2</span>, 
                           do_contrast_fit <span class="op">=</span> <span class="cn">T</span>,
                           <span class="co"># we use only the first row of the contrast matrix L2</span>
                           my_contrast_matrix <span class="op">=</span> <span class="va">L2</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>


<span class="co"># extract fixed efect model estimate of baseline contrast (pre treatment differences between groups)</span>
<span class="va">r0</span> <span class="op">=</span> <span class="fu"><a href="../reference/ExtractResult.html">ExtractResult</a></span><span class="op">(</span>model.fit.list <span class="op">=</span> <span class="va">fit0</span>,
                   what <span class="op">=</span> <span class="st">'gene.t.ranks'</span>,
                   coefficient.number <span class="op">=</span> <span class="fl">1</span>,
                   coef.name <span class="op">=</span> <span class="st">'baseline'</span><span class="op">)</span>
<span class="co">## run gene set enrichment </span>
<span class="va">hlmk.0</span> <span class="op">=</span> <span class="fu"><a href="../reference/FgseaList.html">FgseaList</a></span><span class="op">(</span>rank.list.celltype <span class="op">=</span> <span class="va">r0</span>,
                   pathways <span class="op">=</span> <span class="va">hlmk</span>,
                   BPPARAM <span class="op">=</span> <span class="va">pparam</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="further-analysis-and-curation-of-enrichment-results">Further analysis and curation of enrichment results<a class="anchor" aria-label="anchor" href="#further-analysis-and-curation-of-enrichment-results"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># full set of leading edge genes indexed by celltype x effect x module </span>
<span class="va">lefull</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/GetLeadingEdgeFull.html">GetLeadingEdgeFull</a></span><span class="op">(</span>gsea.list <span class="op">=</span> <span class="va">hlmk.treat</span>,
                                     padj.filter <span class="op">=</span> <span class="fl">0.02</span>, 
                                     NES.filter <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>

<span class="co"># extract model fit results instead of ranks</span>
<span class="co"># automatically this sets argument `result` to 'statistics'</span>
<span class="va">fit1.res</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/ExtractResult.html">ExtractResult</a></span><span class="op">(</span>model.fit.list <span class="op">=</span> <span class="va">fit1</span> , 
                                  coefficient.number <span class="op">=</span> <span class="fl">3</span>, 
                                  coef.name <span class="op">=</span> <span class="st">'treatment'</span><span class="op">)</span>

<span class="co"># combine GSEA results with model coefficient for each gene in leading edge </span>
<span class="co"># include all leading edge genes irrespective of individual gene p value </span>
<span class="va">cr</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/CombineResults.html">CombineResults</a></span><span class="op">(</span>gsealist <span class="op">=</span> <span class="va">hlmk.treat</span>, 
                             contrastlist <span class="op">=</span> <span class="va">fit1.res</span>, 
                             gseafdr <span class="op">=</span> <span class="fl">0.02</span>, 
                             genefdr <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-all-leading-edge-genes-indexed-by-cell-type">Extract all leading edge genes indexed by cell type<a class="anchor" aria-label="anchor" href="#extract-all-leading-edge-genes-indexed-by-cell-type"></a>
</h3>
<p>This outputs a nested list of leading edge genes from each enrichment
across cell types. list level 1 is cell type, level 2 is enrichment
signal.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">li</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/LeadingEdgeIndexed.html">LeadingEdgeIndexed</a></span><span class="op">(</span>gsea.result.list <span class="op">=</span> <span class="va">hlmk.treat</span>, padj.threshold <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-the-jaccard-similarity-of-the-leading-edge-genes-for-enrichments-within-a-given-cell-type-and-effect">Calculate the Jaccard similarity of the leading edge genes for
enrichments within a given cell type and effect<a class="anchor" aria-label="anchor" href="#calculate-the-jaccard-similarity-of-the-leading-edge-genes-for-enrichments-within-a-given-cell-type-and-effect"></a>
</h3>
<p>This is useful for understanding which enrichment signals may come
from the same vs distinct genes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># figpath.temp = here('figures')</span>
<span class="va">treat.JI</span> <span class="op">=</span> <span class="fu"><a href="../reference/EnrichmentJaccard.html">EnrichmentJaccard</a></span><span class="op">(</span>gsealist <span class="op">=</span> <span class="va">hlmk.treat</span>, 
                          indexedgenes <span class="op">=</span> <span class="va">li</span>, 
                          <span class="co">#saveplot = TRUE, </span>
                          <span class="co">#figpath = figpath.temp,</span>
                          returnJaccardMtx <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># curate results </span>
<span class="va">results.sorted</span> <span class="op">=</span> <span class="va">treat.JI</span><span class="op">$</span><span class="va">sortedgsea</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>signal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">celltype</span>, <span class="va">pathway</span>, sep <span class="op">=</span> <span class="st">'~'</span><span class="op">)</span><span class="op">)</span>
  
<span class="co"># data.table::fwrite(results.sorted, file = paste0(datapath, 'g0.result.sort.txt'),sep = "\t")</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualization-of-enrichment-results">Visualization of enrichment results<a class="anchor" aria-label="anchor" href="#visualization-of-enrichment-results"></a>
</h3>
<p><strong>Create a bubble plot heatmap of enrichment results within
clusters</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># NES_filter to -Inf to plot positive and negative enrichment</span>
<span class="va">p</span> <span class="op">=</span> <span class="fu"><a href="../reference/PlotFgsea.html">PlotFgsea</a></span><span class="op">(</span>gsea_result_list <span class="op">=</span> <span class="va">hlmk.treat</span>, NES_filter <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,padj_filter <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
<p><strong>Create heatmap of gene perturbation fold changes across cell
subsets based on model fit coefficients</strong></p>
<p>Extract and make a heatmap of log fold changes across celltypes.
HeatmapDiag uses the package <a href="https://CRAN.R-project.org/package=slanter" class="external-link">slanter</a> which
accepts the same arguments as <code>pheatmap</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gene.mat</span> <span class="op">=</span> <span class="fu"><a href="../reference/GetGeneMatrix.html">GetGeneMatrix</a></span><span class="op">(</span>result.list <span class="op">=</span> <span class="va">fit1</span>, 
                         pvalfilter <span class="op">=</span> <span class="fl">0.05</span>, 
                         stat_for_matrix <span class="op">=</span> <span class="st">'logFC'</span>,
                         logfcfilter <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="co">#make heatmap  e.g. </span>
<span class="fu">pheatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="va">gene.mat</span>, fontsize_row <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="co"># diagnoalize the heatmap so that the most correlated signals are grouped </span>
<span class="co"># this uses the package slanter </span>
<span class="fu"><a href="../reference/HeatmapDiag.html">HeatmapDiag</a></span><span class="op">(</span>matrix <span class="op">=</span> <span class="va">gene.mat</span>, fontsize_row <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<p><strong>Create heatmap of gene perturbation fold changes from
enrichments across individuals within a cell subset</strong></p>
<p>Visualize the log counts per million at the sample level of the gene
set enrichment results.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># make tidy average data for visualization of weighted pb results </span>
<span class="va">lcmp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pb</span>, <span class="fu">edgeR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/edgeR/man/cpm.html" class="external-link">cpm</a></span>, log <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span>

<span class="co"># </span>
<span class="va">le_expr</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/LeadEdgeTidySampleExprs.html">LeadEdgeTidySampleExprs</a></span><span class="op">(</span>av.exprs.list <span class="op">=</span> <span class="va">lcmp</span>,
                                           gsea.list <span class="op">=</span> <span class="va">hlmk.treat</span>, 
                                           padj.filter <span class="op">=</span> <span class="fl">0.1</span>,
                                           NES.filter <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>


<span class="co"># example plot of sample level average leading edge genes annotated </span>
<span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/LeadEdgeSampleHeatmap.html">LeadEdgeSampleHeatmap</a></span><span class="op">(</span>tidy.exprs.list <span class="op">=</span> <span class="va">le_expr</span>,
                               modulename <span class="op">=</span> <span class="st">"HALLMARK_HYPOXIA"</span>,
                               elltype_plot <span class="op">=</span> <span class="st">"CD4_NaiveTcell"</span>,
                               metadata <span class="op">=</span> <span class="va">meta</span>, 
                               metadata_annotate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'group'</span>, <span class="st">'timepoint'</span>, <span class="st">'age'</span>, <span class="st">'sex'</span><span class="op">)</span>,
                               sample_column <span class="op">=</span> <span class="st">'sample'</span>,
                               returnmat <span class="op">=</span> <span class="cn">FALSE</span>, 
                               savepath <span class="op">=</span> <span class="va">figpath</span>, 
                               savename <span class="op">=</span> <span class="st">"filename"</span><span class="op">)</span>

<span class="co"># see also: </span>
<span class="co"># scglmmr::TopGenesTidySampleExprs() - same as aobve for 'top' de genes estimated by model coeffcient / p value. </span>
<span class="co"># scglmmr::GetTidySummary() - for custom plotting</span>


<span class="co"># sample level vsualization of average data above </span>
<span class="co"># repeat this for all enriched pathways </span>
<span class="va">heatpath</span> <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"sime/path"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">heatpath</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">le_expr</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">cdat</span> <span class="op">=</span> <span class="va">le_expr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="va">ctype</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">le_expr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="va">umod</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cdat</span><span class="op">$</span><span class="va">module</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">u</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">umod</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/LeadEdgeSampleHeatmap.html">LeadEdgeSampleHeatmap</a></span><span class="op">(</span>tidy.exprs.list <span class="op">=</span> <span class="va">le_expr</span>, 
                          modulename <span class="op">=</span> <span class="va">umod</span><span class="op">[</span><span class="va">u</span><span class="op">]</span>, 
                          celltype_plot <span class="op">=</span> <span class="va">ctype</span>,
                          metadata <span class="op">=</span> <span class="va">meta</span>, metadata_annotate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'group'</span>, <span class="st">'timepoint'</span>, <span class="st">'age'</span>, <span class="st">'gender'</span><span class="op">)</span>,
                          sample_column <span class="op">=</span> <span class="st">'sample'</span>,
                          returnmat <span class="op">=</span> <span class="cn">F</span>, 
                          savepath <span class="op">=</span> <span class="va">heatpath</span>,
                          savename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ctype</span>, <span class="st">" "</span>,<span class="va">umod</span><span class="op">[</span><span class="va">u</span><span class="op">]</span>,<span class="st">'.pdf'</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>You can also create a customized map by returning the matrix from
<code>LeadEdgeSampleHeatmap</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># scglmmr function to extract leading edge genes </span>
<span class="va">lexp1</span> <span class="op">=</span> <span class="fu"><a href="../reference/LeadEdgeTidySampleExprs.html">LeadEdgeTidySampleExprs</a></span><span class="op">(</span>av.exprs.list <span class="op">=</span> <span class="va">lcpm</span>, gsea.list <span class="op">=</span> <span class="va">g1c</span>, padj.filter <span class="op">=</span> <span class="fl">0.05</span>, NES.filter <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># annotate time and batch on the heatmap</span>
<span class="va">heatmap_anno</span> <span class="op">=</span> <span class="va">meta</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'batch'</span>, <span class="st">'timepoint'</span><span class="op">)</span><span class="op">]</span>
<span class="va">anno_color</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  timepoint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span> <span class="op">=</span> <span class="st">"orange"</span>, <span class="st">'2'</span> <span class="op">=</span> <span class="st">'red'</span>,  <span class="st">"0"</span> <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,
  batch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">'2'</span> <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># define your own custom color vector for the log fold change values</span>
<span class="va">cu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#053061"</span>, <span class="st">"#1E61A5"</span>, <span class="st">"#3C8ABE"</span>, <span class="st">"#7CB7D6"</span>, <span class="st">"#BAD9E9"</span>, <span class="st">"#E5EEF3"</span>, 
       <span class="st">"#F9EAE1"</span>, <span class="st">"#F9C7AD"</span>, <span class="st">"#EB9273"</span>, <span class="st">"#CF5246"</span>, <span class="st">"#AB1529"</span>, <span class="st">"#67001F"</span><span class="op">)</span>

<span class="co"># scglmmr function for leading edge gene matrix across donors</span>
<span class="va">mat2</span> <span class="op">=</span> <span class="fu">scglmmr</span><span class="fu">::</span><span class="fu"><a href="../reference/LeadEdgeSampleHeatmap.html">LeadEdgeSampleHeatmap</a></span><span class="op">(</span>tidy.exprs.list <span class="op">=</span> <span class="va">le_expr</span>, 
                                 modulename <span class="op">=</span> <span class="st">"reactome interferon signaling"</span>,
                                 celltype_plot <span class="op">=</span> <span class="st">'CD14_Mono'</span>,
                                 <span class="co"># metadata = meta, # unused  </span>
                                 <span class="co"># metadata_annotate = c('batch'), # unused </span>
                                 sample_column <span class="op">=</span> <span class="st">'sample'</span>,
                                 returnmat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># draw heatmap </span>
<span class="fu">pheatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="va">mat2</span>, 
                   border_color <span class="op">=</span> <span class="cn">NA</span>,
                   treeheight_row <span class="op">=</span> <span class="fl">0</span>, treeheight_col <span class="op">=</span> <span class="fl">10</span>,
                   annotation <span class="op">=</span> <span class="va">heatmap_anno</span>,
                   annotation_colors <span class="op">=</span> <span class="va">anno_color</span>,
                   color <span class="op">=</span> <span class="va">cu</span>,
                   width <span class="op">=</span> <span class="fl">5</span>,  height <span class="op">=</span> <span class="fl">7.6</span>,
                   <span class="co"># this can be set to false to look at raw expression e.g. </span>
                   scale <span class="op">=</span> <span class="st">"row"</span>,
                   filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">figpath</span>, <span class="st">"mono_d1_ReactomeIFN.pdf"</span><span class="op">)</span>
                   <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Mulè.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
